@using DuAn.Models.CustomModel;
@model HomeModel
@{ Layout = null;}

<div class="col-md-4">
    <div class="card card-custom gutter-b bg-diagonal bg-diagonal-light-primary">
        <div class="card-body">
            <div class="d-flex align-items-center justify-content-between p-4 flex-lg-wrap flex-xl-nowrap">
                <div class="d-flex flex-column mr-5">
                    <span class="h4 text-dark text-hover-primary mb-5">
                        @Model.formatNumber(Model.giaDien * Model.sanLuongTrongNgay.Sum(x => x.GiaTri) * 0.000001) tỷ
                    </span>
                    <p class="text-dark-50">
                        Doanh thu ngày @Model.date.Day
                    </p>
                </div>
                <div class="ml-6 ml-lg-0 ml-xxl-6 flex-shrink-0">
                    <a href="javascript:void(0)" id="chiTietNgayBtn" class="btn font-weight-bolder text-uppercase btn-primary py-4 px-6">
                        Chi tiết
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col-md-4">
    <div class="card card-custom gutter-b bg-diagonal bg-diagonal-light-success">
        <div class="card-body">
            <div class="d-flex align-items-center justify-content-between p-4 flex-lg-wrap flex-xl-nowrap">
                <div class="d-flex flex-column mr-5">
                    <span class="h4 text-dark text-hover-primary mb-5">
                        @Model.formatNumber(Model.doanhThuThang * 0.000001) tỷ
                    </span>
                    <p class="text-dark-50">
                        Doanh thu tháng @Model.date.Month
                    </p>
                </div>
                <div class="ml-6 ml-lg-0 ml-xxl-6 flex-shrink-0">
                    <a href="javascript:void(0)" id="doanhThuThangBtn" class="btn font-weight-bolder text-uppercase btn-success py-4 px-6">
                        Chi tiết
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col-md-4">
    <div class="card card-custom gutter-b bg-diagonal bg-diagonal-light-warning">
        <div class="card-body">
            <div class="d-flex align-items-center justify-content-between p-4 flex-lg-wrap flex-xl-nowrap">
                <div class="d-flex flex-column mr-5">
                    <span class="h4 text-dark text-hover-primary mb-5">
                        @Model.formatNumber(Model.doanhThuNam * 0.000001) tỷ
                    </span>
                    <p class="text-dark-50">
                        Doanh thu năm @Model.date.Year
                    </p>
                </div>
                <div class="ml-6 ml-lg-0 ml-xxl-6 flex-shrink-0">
                    <a href="javascript:void(0)" id="doanhThuNamBtn" class="btn font-weight-bolder text-uppercase btn-success py-4 px-6">
                        Chi tiết
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col-xl-3 col-12 col-md-6">
    <!--begin::Mixed Widget 18-->
    <div class="card card-custom gutter-b card-stretch">
        <!--begin::Header-->
        <div class="card-header border-0 pt-5">
            <div class="card-title font-weight-bolder d-flex justify-content-between">
                <div class="card-label">
                    <i class="icon-xl fab fa-buffer text-primary"></i> Lũy kế tháng @Model.date.Month
                </div>
            </div>
            <div class="card-toolbar">
                <a href="javascript:void(0)" id="chiTietThangBtn" class="btn btn-sm btn-success font-weight-bold">
                    <i class="fas fa-list"></i>Chi tiết
                </a>
            </div>
        </div>
        <!--end::Header-->
        <!--begin::Body-->
        <div class="card-body" style="position: relative;">
            <!--begin::Chart-->
            <div id="insert_chart" class="d-flex justify-content-center d-flex align-items-center" style="height: 250px; min-height: 192.089px;margin-bottom:60px;"><h1 id="chart1Label"></h1></div>
            <!--end::Chart-->
            <!--begin::Items-->
            <div class="mt-n12 position-relative zindex-0">
                <!--begin::Widget Item-->
                <div class="d-flex align-items-center">
                    <!--begin::Symbol-->
                    <div class="symbol symbol-circle symbol-40 symbol-light mr-3 flex-shrink-0">
                        <div class="symbol-label">
                            <span class="svg-icon svg-icon-lg svg-icon-gray-500">
                                <!--begin::Svg Icon | path:assets/media/svg/icons/Design/Layers.svg-->
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                        <polygon points="0 0 24 0 24 24 0 24"></polygon>
                                        <path d="M12.9336061,16.072447 L19.36,10.9564761 L19.5181585,10.8312381 C20.1676248,10.3169571 20.2772143,9.3735535 19.7629333,8.72408713 C19.6917232,8.63415859 19.6104327,8.55269514 19.5206557,8.48129411 L12.9336854,3.24257445 C12.3871201,2.80788259 11.6128799,2.80788259 11.0663146,3.24257445 L4.47482784,8.48488609 C3.82645598,9.00054628 3.71887192,9.94418071 4.23453211,10.5925526 C4.30500305,10.6811601 4.38527899,10.7615046 4.47382636,10.8320511 L4.63,10.9564761 L11.0659024,16.0730648 C11.6126744,16.5077525 12.3871218,16.5074963 12.9336061,16.072447 Z" fill="#000000" fill-rule="nonzero"></path>
                                        <path d="M11.0563554,18.6706981 L5.33593024,14.122919 C4.94553994,13.8125559 4.37746707,13.8774308 4.06710397,14.2678211 C4.06471678,14.2708238 4.06234874,14.2738418 4.06,14.2768747 L4.06,14.2768747 C3.75257288,14.6738539 3.82516916,15.244888 4.22214834,15.5523151 C4.22358765,15.5534297 4.2250303,15.55454 4.22647627,15.555646 L11.0872776,20.8031356 C11.6250734,21.2144692 12.371757,21.2145375 12.909628,20.8033023 L19.7677785,15.559828 C20.1693192,15.2528257 20.2459576,14.6784381 19.9389553,14.2768974 C19.9376429,14.2751809 19.9363245,14.2734691 19.935,14.2717619 L19.935,14.2717619 C19.6266937,13.8743807 19.0546209,13.8021712 18.6572397,14.1104775 C18.654352,14.112718 18.6514778,14.1149757 18.6486172,14.1172508 L12.9235044,18.6705218 C12.377022,19.1051477 11.6029199,19.1052208 11.0563554,18.6706981 Z" fill="#000000" opacity="0.3"></path>
                                    </g>
                                </svg>
                                <!--end::Svg Icon-->
                            </span>
                        </div>
                    </div>
                    <!--end::Symbol-->
                    <!--begin::Title-->
                    <div>
                        <p class="font-size-h6 text-dark-75 font-weight-bolder">@Model.numberFormatDuKienThang MWh</p>
                        <div class="font-size-sm text-muted font-weight-bold mt-1">Sản lượng kế hoạch</div>
                    </div>
                    <!--end::Title-->
                </div>
                <!--end::Widget Item-->
            </div>
            <!--end::Items-->
        </div>
        <!--end::Body-->
    </div>
    <!--end::Mixed Widget 18-->
</div>

<div class="col-xl-3 col-12 col-md-6">
    <!--begin::Mixed Widget 18-->
    <div class="card card-custom gutter-b card-stretch">
        <!--begin::Header-->
        <div class="card-header border-0 pt-5">
            <div class="card-title font-weight-bolder">
                <div class="card-label">
                    <i class="icon-xl fab fa-buffer text-primary"></i> Lũy kế năm @Model.date.Year
                </div>
            </div>
            <div class="card-toolbar">
                <a href="javascript:void(0)" id="chiTietNamBtn" class="btn btn-sm btn-success font-weight-bold">
                    <i class="fas fa-list"></i>Chi tiết
                </a>
            </div>
        </div>
        <!--end::Header-->
        <!--begin::Body-->
        <div class="card-body" style="position: relative;">
            <!--begin::Chart-->
            <div id="insert_chart2" class="d-flex justify-content-center d-flex align-items-center" style="height: 250px; min-height: 192.089px;margin-bottom:60px;"><h1 id="chart2Label"></h1></div>
            <!--end::Chart-->
            <!--begin::Items-->
            <div class="mt-n12 position-relative zindex-0">
                <!--begin::Widget Item-->
                <div class="d-flex align-items-center">
                    <!--begin::Symbol-->
                    <div class="symbol symbol-circle symbol-40 symbol-light mr-3 flex-shrink-0">
                        <div class="symbol-label">
                            <span class="svg-icon svg-icon-lg svg-icon-gray-500">
                                <!--begin::Svg Icon | path:assets/media/svg/icons/Design/Layers.svg-->
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                        <polygon points="0 0 24 0 24 24 0 24"></polygon>
                                        <path d="M12.9336061,16.072447 L19.36,10.9564761 L19.5181585,10.8312381 C20.1676248,10.3169571 20.2772143,9.3735535 19.7629333,8.72408713 C19.6917232,8.63415859 19.6104327,8.55269514 19.5206557,8.48129411 L12.9336854,3.24257445 C12.3871201,2.80788259 11.6128799,2.80788259 11.0663146,3.24257445 L4.47482784,8.48488609 C3.82645598,9.00054628 3.71887192,9.94418071 4.23453211,10.5925526 C4.30500305,10.6811601 4.38527899,10.7615046 4.47382636,10.8320511 L4.63,10.9564761 L11.0659024,16.0730648 C11.6126744,16.5077525 12.3871218,16.5074963 12.9336061,16.072447 Z" fill="#000000" fill-rule="nonzero"></path>
                                        <path d="M11.0563554,18.6706981 L5.33593024,14.122919 C4.94553994,13.8125559 4.37746707,13.8774308 4.06710397,14.2678211 C4.06471678,14.2708238 4.06234874,14.2738418 4.06,14.2768747 L4.06,14.2768747 C3.75257288,14.6738539 3.82516916,15.244888 4.22214834,15.5523151 C4.22358765,15.5534297 4.2250303,15.55454 4.22647627,15.555646 L11.0872776,20.8031356 C11.6250734,21.2144692 12.371757,21.2145375 12.909628,20.8033023 L19.7677785,15.559828 C20.1693192,15.2528257 20.2459576,14.6784381 19.9389553,14.2768974 C19.9376429,14.2751809 19.9363245,14.2734691 19.935,14.2717619 L19.935,14.2717619 C19.6266937,13.8743807 19.0546209,13.8021712 18.6572397,14.1104775 C18.654352,14.112718 18.6514778,14.1149757 18.6486172,14.1172508 L12.9235044,18.6705218 C12.377022,19.1051477 11.6029199,19.1052208 11.0563554,18.6706981 Z" fill="#000000" opacity="0.3"></path>
                                    </g>
                                </svg>
                                <!--end::Svg Icon-->
                            </span>
                        </div>
                    </div>
                    <!--end::Symbol-->
                    <!--begin::Title-->
                    <div>
                        <p class="font-size-h6 text-dark-75 font-weight-bolder">@Model.numberFormatDuKienNam MWh</p>
                        <div class="font-size-sm text-muted font-weight-bold mt-1">Sản lượng kế hoạch</div>
                    </div>
                    <!--end::Title-->
                </div>
                <!--end::Widget Item-->
            </div>
            <!--end::Items-->
        </div>
        <!--end::Body-->
    </div>
    <!--end::Mixed Widget 18-->
</div>

<div class="col-xl-6">
    <!--begin::Mixed Widget 18-->
    <div class="card card-custom gutter-b card-stretch">
        <!--begin::Header-->
        <div class="card-header border-0 pt-5">
            <div class="card-title font-weight-bolder">
                <div class="card-label">
                    <i class="icon-xl fab fa-searchengin text-primary"></i> Tình hình thu thập dữ liệu tại nhà máy
                </div>
            </div>
        </div>
        <!--end::Header-->
        <!--begin::Body-->
        <div class="card-body" style="position: relative;">
            <div class="row d-flex justify-content-center" style="height:100%">
                <div class="col-xl-6">
                    <table class="table table-hover table-bordered" style="height:100%">
                        <thead>
                            <tr>
                                <th scope="col" class="text-center">Loại điểm đo</th>
                                <th scope="col" class="text-center">Đã thu thập</th>
                                <th scope="col" class="text-center">Thu thập thiếu</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (NumberOfMissingData item in Model.countMissingData)
                            {
                                <tr>
                                    <td class="align-middle">
                                        @item.type
                                    </td>
                                    <td class="text-right text-success align-middle">
                                        @item.done
                                    </td>
                                    <td class="text-right text-danger align-middle">
                                        @item.notYet
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="col-xl-6 col-sm-8 insert_chart4">
                    <h1 id="chart4Label"></h1>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="col-md-12 col-sm-12 col-lg-12 col-xl-12">
    <div class="card card-custom gutter-b card-stretch">
        <div class="card-header border-0 pt-5">
            <div class="card-title font-weight-bolder">
                <div class="card-label" style=" font:Open">
                    <i class="icon-xl far fa-chart-bar text-primary"></i> Sản lượng trong ngày @Model.date.ToString("dd/MM/yyyy")
                </div>
            </div>
        </div>
        <div class="card-body" style="position: relative;">
            <!--begin::Header-->
            <div class="card-title font-weight-bolder" style="width:100%; height:90%;">
                <div class="card-label" style="width:100%; height:100%;">
                    <div id="sanLuongTrongNgay" class="font-size-sm text-muted mt-2 d-flex justify-content-center d-flex align-items-center" style="height:400px"><h1 id="chart3Label"></h1></div>
                </div>
            </div>
        </div>
        <!--end::Body-->
    </div>
</div>
<div class="col-md-12 col-sm-12 col-lg-12 col-xl-12">
    <div class="card card-custom gutter-b card-stretch">
        <div class="card-header border-0 pt-5">
            <div class="card-title font-weight-bolder d-flex justify-content-between" style="width:100%">
                <div class="card-label">
                    <i class="icon-xl fas fa-info-circle text-primary"></i> Sản lượng chi tiết
                </div>
            </div>
        </div>
        <div class="card-body" style="position: relative;">
            <!--begin::Header-->
            <div class="card-title font-weight-bolder" style="width:100%; height:100%;">
                <div class="card-label" style="width:100%; height:100%;">
                    <div class="tab-content">
                        <!--begin::Table-->
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-vertical-center text-center" id="myTable">
                                <thead>
                                    <tr class="text-white font-weight-bolder text-uppercase bg-primary">
                                        <th rowspan="2">Mã điểm đo</th>
                                        <th rowspan="2">Tên điểm đo</th>
                                        <th rowspan="2">Tính chất</th>
                                        <th colspan="2">
                                            Kênh giao
                                        </th>
                                        <th colspan="2">
                                            Kênh nhận
                                        </th>
                                        <th rowspan="2"></th>
                                    </tr>
                                    <tr class="text-white font-weight-bolder text-uppercase bg-primary">
                                        <th>
                                            Hữu công
                                        </th>
                                        <th>
                                            Vô công
                                        </th>
                                        <th>
                                            Hữu công
                                        </th>
                                        <th>
                                            Vô công
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{ double sumKWHGiao = 0, sumKWHNhan = 0, sumKvarGiao = 0, sumKvarNhan = 0;}
                                    @foreach (DiemDoData item in Model.data)
                                    {
                                        sumKWHGiao += item.sumKwhGiao;
                                        sumKWHNhan += item.sumKwhNhan;
                                        sumKvarGiao += item.sumKvarhGiao;
                                        sumKvarNhan += item.sumKvarhNhan;
                                    }
                                    @for (int i = 0; i < Model.data.Count; i++)
                                    {
                                        var valueNumber = i + 1;
                                        <tr>
                                            <td class="">
                                                <p class="text-dark-75 font-weight-bolder text-hover-primary mb-1 font-size-lg">@Model.data[i].maDiemDo</p>
                                            </td>
                                            <td>
                                                <span class="text-dark-75 font-weight-bolder d-block font-size-lg text-left">@Model.data[i].tenDiemDo</span>
                                            </td>
                                            <td>
                                                <span class="text-dark-75 font-weight-bolder d-block font-size-lg text-left">@Model.data[i].tinhChat</span>
                                            </td>
                                            <td>
                                                <span class="text-dark-75 font-weight-bolder d-block font-size-lg text-right">@Model.formatNumber(Model.data[i].sumKwhGiao)</span>
                                            </td>
                                            <td>
                                                <span class="text-dark-75 font-weight-bolder d-block font-size-lg text-right">@Model.formatNumber(Model.data[i].sumKvarhGiao)</span>
                                            </td>
                                            <td>
                                                <span class="text-dark-75 font-weight-bolder d-block font-size-lg text-right">@Model.formatNumber(Model.data[i].sumKwhNhan)</span>
                                            </td>
                                            <td>
                                                <span class="text-dark-75 font-weight-bolder d-block font-size-lg text-right">@Model.formatNumber(Model.data[i].sumKvarhNhan)</span>
                                            </td>
                                            <td>
                                                <a href="javascript:void(0)" data-id="@Model.data[i].maDiemDo" class="btn btn-light-success font-weight-bolder font-size-sm mt-4 click-chitiet">Chi tiết</a>
                                            </td>
                                        </tr>
                                    }
                                    <tr class="" style="border-top:1px solid black">
                                        <td class="pl-0 py-8" colspan="3">
                                            <span class="text-dark-75 font-weight-bolder d-block font-size-lg text-center">Tổng</span>
                                        </td>
                                        <td>
                                            <span class="text-dark-75 font-weight-bolder d-block font-size-lg text-right">@Model.formatNumber(sumKWHGiao)</span>
                                        </td>
                                        <td>
                                            <span class="text-dark-75 font-weight-bolder d-block font-size-lg text-right">@Model.formatNumber(sumKvarGiao)</span>
                                        </td>
                                        <td>
                                            <span class="text-dark-75 font-weight-bolder d-block font-size-lg text-right">@Model.formatNumber(sumKWHNhan)</span>
                                        </td>
                                        <td>
                                            <span class="text-dark-75 font-weight-bolder d-block font-size-lg text-right">@Model.formatNumber(sumKvarNhan)</span>
                                        </td>
                                        <td>
                                            <span class="text-dark-75 font-weight-bolder d-block font-size-lg"></span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <!--end::Table-->
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal-->
        <!--end::Body-->
    </div>
</div>
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
    
</div>
<div class="modal fade" id="chiTietThangModal" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
</div>
<div class="modal fade" id="chiTietNamModal" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
</div>

<script>
    
    $('.click-chitiet').click(function () {
        var url = "@Url.Action("getModelDetail", "Home")";
        var ID = $(this).attr("data-id");
        var date = "@Model.date.ToString("dd/MM/yyyy")";
        $.ajax({
            cache: false,
            url: url,
            data: { id: ID, date: date },
            beforeSend: function () {
                showLoading();
            },
            success: function (data) {
                hideLoading();
                $('#exampleModalCenter').html(data);
                $('#exampleModalCenter').modal('show');
            },
            error: function (xhr, ajaxOptions, thrownError) {
            }
        });
    });
    $('#chiTietNgayBtn').click(function () {
        var url = "@Url.Action("getDoanhThuNgay", "Home")";
        var date = "@Model.date.ToString("dd/MM/yyyy")";
        $.ajax({
            cache: false,
            url: url,
            data: { date: date },
            beforeSend: function () {
                showLoading();
            },
            success: function (data) {
                hideLoading();
                if (data == null || data == "") {
                    showMessage("Không có dữ liệu", false);
                }
                else {
                    $('#exampleModalCenter').html(data);
                    $('#exampleModalCenter').modal('show');
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
            }
        });
    });
    $('#chiTietThangBtn').click(function () {
        var url = "@Url.Action("getChiTietThangModal", "Home")";
        var date = "@Model.date.ToString("dd/MM/yyyy")";
        $.ajax({
            cache: false,
            url: url,
            data: { date: date },
            beforeSend: function () {
                showLoading();
            },
            success: function (data) {
                hideLoading();
                if (data == null||data=="") {
                    showMessage("Không có dữ liệu", false);
                }
                else {
                    $('#chiTietThangModal').html(data);
                    $('#chiTietThangModal').modal('show');
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
            }
        });
    });
    $('#doanhThuThangBtn').click(function () {
        var url = "@Url.Action("getDoanhThuThang", "Home")";
        var date = "@Model.date.ToString("dd/MM/yyyy")";
        $.ajax({
            cache: false,
            url: url,
            data: { date: date },
            beforeSend: function () {
                showLoading();
            },
            success: function (data) {
                hideLoading();
                if (data == null||data=="") {
                    showMessage("Không có dữ liệu", false);
                }
                else {
                    $('#exampleModalCenter').html(data);
                    $('#exampleModalCenter').modal('show');
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
            }
        });
    });
    $('#chiTietNamBtn').click(function () {
        var url = "@Url.Action("getChiTietNamModal", "Home")";
        var date = "@Model.date.ToString("dd/MM/yyyy")";
        $.ajax({
            cache: false,
            url: url,
            data: { date: date },
            beforeSend: function () {
                showLoading();
            },
            success: function (data) {
                hideLoading();
                if (data == null||data=="") {
                    showMessage("Không có dữ liệu", false);
                }
                else {
                    $('#chiTietNamModal').html(data);
                    $('#chiTietNamModal').modal('show');
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
            }
        });
    });
    $('#doanhThuNamBtn').click(function () {
        var url = "@Url.Action("getDoanhThuNam", "Home")";
        var date = "@Model.date.ToString("dd/MM/yyyy")";
        showLoading();
        $.ajax({
            cache: false,
            url: url,
            data: { date: date },
            success: function (data) {
                if (data == null || data == "") {
                    hideLoading();
                    showMessage("Không có dữ liệu", false);
                }
                else {
                    hideLoading();
                    $('#exampleModalCenter').html(data);
                    $('#exampleModalCenter').modal('show');
                }

            },
            error: function (xhr, ajaxOptions, thrownError) {
            }
        });
    });
    $(document).ready(function () {
    var duKienThang = @Html.Raw(Json.Encode(Model.duKienThang));
    var duKienNam = @Html.Raw(Json.Encode(Model.duKienNam));
    var thucTeThang=@Html.Raw(Json.Encode(Model.thucTeThang));
    var thucTeNam=@Html.Raw(Json.Encode(Model.thucTeNam));
    var sanLuongTrongNgay=@Html.Raw(Json.Encode(Model.sanLuongTrongNgay));
    var percentFormatThang =@Html.Raw(Json.Encode(Model.percentFormatThang));
    var percentFormatNam =@Html.Raw(Json.Encode(Model.percentFormatNam));
    var numberFormatThang =@Html.Raw(Json.Encode(Model.numberFormatThang));
    var numberFormatNam =@Html.Raw(Json.Encode(Model.numberFormatNam));
    var daThuThap=@Html.Raw(Json.Encode(Model.daThuThap));
    var chuaThuThap =@Html.Raw(Json.Encode(Model.chuaThuThap));
    setValue(duKienThang, duKienNam, thucTeThang, thucTeNam, sanLuongTrongNgay, percentFormatThang, percentFormatNam, numberFormatThang, numberFormatNam, daThuThap, chuaThuThap);
    });
</script>